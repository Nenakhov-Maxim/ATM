# QR-код аутентификация в AT-Manager

## Описание функционала

Реализована система входа в приложение с помощью QR-кодов, которые могут быть отсканированы USB-сканером.

## Компоненты системы

### 1. Модель пользователя
- Добавлено поле `qr_code` в модель `User`
- Поле уникальное и может быть пустым

### 2. Веб-интерфейс
- Кнопка "Вход по QR-коду" на странице входа
- Модальное окно для сканирования QR-кода
- Поддержка как USB-сканера, так и ручного ввода

### 3. Backend API
- Endpoint `/qr-login/` для обработки QR-аутентификации
- JSON API с проверкой QR-кода и автоматическим входом

### 4. Административная панель
- Поле QR-кода добавлено в админку Django
- Возможность просмотра и редактирования QR-кодов

## Использование

### Генерация QR-кодов для пользователей

```bash
# Активировать виртуальное окружение
source venv/bin/activate

# Перейти в директорию проекта
cd ATM

# Сгенерировать QR-коды для всех пользователей без кодов
python manage.py generate_qr_codes

# Сгенерировать QR-код для конкретного пользователя
python manage.py generate_qr_codes --username имя_пользователя

# Перегенерировать QR-коды для всех пользователей
python manage.py generate_qr_codes --all
```

### Настройка QR-кодов через админку

1. Войдите в админку Django
2. Перейдите в раздел "Пользователи"
3. Выберите пользователя
4. Введите или измените QR-код в соответствующем поле
5. Сохраните изменения

### Использование QR-сканера

1. На странице входа нажмите кнопку "Вход по QR-коду"
2. Откроется модальное окно
3. Отсканируйте QR-код с помощью USB-сканера
4. Система автоматически выполнит вход

### Ручной ввод QR-кода

1. В модальном окне есть поле для ручного ввода
2. Введите QR-код и нажмите "Войти"

## Технические детали

### Как работает USB-сканер

USB-сканер QR-кодов работает как клавиатура:
1. При сканировании он "печатает" содержимое QR-кода
2. JavaScript ловит этот ввод в скрытом поле
3. После завершения ввода (обычно Enter) код отправляется на сервер

### API Endpoint

**POST** `/qr-login/`

Тело запроса:
```json
{
    "qr_code": "19EDDB53F415"
}
```

Ответ при успехе:
```json
{
    "success": true,
    "redirect_url": "/master/",
    "message": "Добро пожаловать, Максим!"
}
```

Ответ при ошибке:
```json
{
    "success": false,
    "error": "Пользователь с таким QR-кодом не найден"
}
```

### Безопасность

- QR-коды уникальны для каждого пользователя
- Проверяется активность пользователя (`is_active=True`)
- Используется стандартная система аутентификации Django
- CSRF защита отключена только для QR-endpoint

## Файлы, которые были изменены/добавлены

1. `login/models.py` - добавлено поле qr_code
2. `login/views.py` - добавлен view qr_login
3. `login/urls.py` - добавлен URL для QR-аутентификации
4. `login/admin.py` - добавлено поле в админку
5. `app/templates/login.html` - добавлено модальное окно
6. `app/static/css/lg-style.css` - стили для модального окна
7. `app/static/js/login.js` - JavaScript для работы с QR-сканером
8. `login/management/commands/generate_qr_codes.py` - команда для генерации QR-кодов
9. `login/migrations/0006_user_qr_code.py` - миграция базы данных

## Примеры QR-кодов

QR-коды генерируются в формате: 12-символьная строка из цифр и букв (например: `19EDDB53F415`)

Для создания физических QR-кодов можно использовать любой онлайн-генератор QR-кодов, вводя сгенерированный код как текст.
